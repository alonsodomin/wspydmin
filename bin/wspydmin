#!/bin/sh

## WSPydmin - WebSphere Python Administration Library
## Copyright (C) 2010  Antonio Alonso Domínguez
##
## This program is free software: you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with this program.  If not, see <http://www.gnu.org/licenses/>.

# Resolve links - $0 may be a softlink - and obtain
# the root directory of the script environment

DISCLAIMER <<EOF
WSPydmin  Copyright (C) 2010  Antonio Alonso Domínguez

This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
This is free software, and you are welcome to redistribute it
under certain conditions; type `show c' for details.
EOF

PRG="$0"

while [ -h "${PRG}" ]; do
	ls=`ls -ld "${PRG}"`
	link=`expr "${ls}" : '.*->\(.*\)$'`
	if expr "${link}" : '/.*' > /dev/null; then
		PRG="${link}"
	else
		PRG=`dirname "${PRG}"`/"${link}"
	fi
done

WSPYDMIN_HOME=`dirname ${PRG}`
WSPYDMIN_LIB="${WSPYMIN_HOME}/python"
WSPYDMIN_CONF="${WSPYDMIN_HOME}/etc/wspydmin.conf"

if [ ! -f "${WSPYDMIN_CONF}" ]; then
	echo "ERROR: Configuration file '${WSPYDMIN_CONF}' not found"
	exit 1
fi

source ${WSPYDMIN_CONF}

if [ -z "${WAS_HOME}" ]; then
	echo "ERROR: Configuration variable WAS_HOME was not set."
	exit 1
fi

if [ ! -d "${WAS_HOME}" ]; then
	echo "ERROR: WAS_HOME: ${WAS_HOME} is not a directory."
	exit 1
fi

WSADMIN_CMD="${WAS_HOME}/bin/wsadmin.sh"

if [ ! -f "${WASADMIN_CMD}" ]; then
	echo "ERROR: WAS scripting interpreter '${WSADMIN_CMD}' doesn't exists."
	exit 1
fi

export WAS_HOME
export WSPYDMIN_HOME
export WSPYDMIN_LIB

WSADMIN_ARGS="-lang jython -username ${WAS_USERNAME} -password ${WAS_PASSWORD} -profile ${WSPYMIN_LIB}/wasprofile.py"
if [ ! -z "${WAS_DEFAULT_PROFILE}" ]; then
	WSADMIN_ARGS="${WSADMIN_ARGS} -profileName ${WAS_DEFAULT_PROFILE}"
fi

if [ -z "$1" ]; then
	echo $DISCLAIMER
	${WSADMIN_CMD} ${WSADMIN_ARGS} $*
else
	script=$1
	shift
	${WSADMIN_CMD} ${WSADMIN_ARGS} -f $script $*
fi